==============
数据库系统笔记
==============

基本介绍
--------

.. image:: ../../_static/images/dbs-overview.*

- DB：相互有关联关系的数据的集合；
- DBMS：管理的数据库的一种软件，可越过操作系统直接管理数据；
- DBAP：不同用户使用的完成某种功能的应用程序。

数据库的种类：

- 关系数据库
- 面向对象数据库
- XML 数据库
- NoSQL 数据库

专业术语扫盲：

- 列/字段/属性/数据项（column/field/attribute/data item）
- 行/\ **元组**\ /记录（row/tuple/record）
- （关系）模式 = 表名 + 表头（格式），关系模式是关系的结构。
- 表/关系 = 表名 + 表头（格式）+ 表内容（值），关系是关系模式在某一时刻的数据
- 超键（super key）：在关系中能唯一标识元组的属性集称为关系模式的超键
- 候选键（candidate key）：不含有多余属性的超键称为候选键
- 主键（primary key）：用户选作元组标识的一个候选键程序主键
- 外键（foreign key）：如果关系模式 R1 中的某属性集不是 R1 的主键，而是另一个关系 R2 的主键则该属性集是关系模式 R1 的外键
- 主属性与非主属性：包含在任何一个候选码中的属性被称作主属性，而其他属性被称作非主属性
- 外码/外键：关系 R 中的一个属性组，它不是 R 的候选码，但它与另一个关系 S 的候选码相对应，则称这个属性组为 R 的外码或外键
- 实体完整性：关系的主码中的属性值不能为空值
- 参照完整性：如果关系 R1 的外码Fk与关系 R2 的主码 Pk 相对应，则 R1 中的每一个元组的Fk值或者等于 R2 中某个元组的 Pk 值，或者为空值
- 用户自定义的完整性：用户针对具体的应用环境定义的完整性约束条件。如 S# 要求是 10 位整数，其中前四位为年度，当前年度与他们的差必须在 4 以内

三级模式：

- External Schema = (External) View（外模式/局部模式）
- (Conceptual) Schema = Conceptual View（概念模式/全局模式/逻辑模式/模式）
- Internal Schema = Internal View（内模式/存储模式/物理模式）

两层映像：

- E-C Mapping（实现逻辑独立性）
- C-I Mapping（实现物理独立性）

数据模型：

- 层次模型（树状结构）
- 网状模型（典型代表？）
- 关系模型（对象-关系数据库）

关系代数
--------

操作符操作的内容是集合，得到的结果也是集合。

基本操作
~~~~~~~~

并
    :math:`R \cup S = \{ t | t \in R \vee t \in S \}` 。

差
    :math:`R - S = \{ t | t \in R \wedge t \notin S \}` 。

积
    :math:`R \times S = S \times R` 。
    R × S 表示 R 中的每一个元组和 S 中的所有元组串接，S × R 表示 S 中的每一个元组和 R 中的所有元组串接。
    因此，它们的结果相同，列的顺序不影响结果。

选择：
    :math:`\sigma_{con}(R) = \{ t | t \in R \wedge con(t) = true \}` 。

投影
    :math:`\Pi_{A_{i1}, A_{i2}, \dots, A_{ik}}(R) = \{ <t[A_{i1}], t[A_{i2}], \dots, t[A_{ik}]> | t \in R \}` 。
    投影可将列属性重新排列。

（列）更名
    :math:`\rho_{\text{new_column_name}}(\text{old_column_name})` 。
    当一个表需要和其自身进行连接运算时，通常要使用更名操作。

扩展操作
~~~~~~~~

交
    :math:`R \cap S = \{ t | t \in R \wedge t \in S \} = R - (R - S) = S - (S - R)` 。注意，差运算的括号不能去。

自然连接
    :math:`R \bowtie S = \sigma_{t[B]=s[B]}(R \times S)` 。自然连接会筛选出两个表相同属性组上值相等的元组。

内连接（\ :math:`\theta`\ -连接 ）
    :math:`R \mathop{\bowtie}\limits_{A \theta B}^{} S = \sigma_{t[A]\ \theta\ s[B]}(R \times S)` 。
    内连接是自然连接更一般的情况。

外连接
    左外连接 :math:`R ⟕ S` ，右外连接 :math:`R ⟖ S` ，全外连接 :math:`R ⟗ S` 。
    外连接 = 自然连接或 :math:`\theta`\ -连接 + 失配的元组与全空元组形成的连接。

除
    :math:`R \div S = \Pi_{R-S}(R)-\Pi_{R-S}((\Pi_{R-S}(R) \times S)-R)` 。
    注意，这里 R - S 指的是属性做差，前面讲的是元组做差。除法比较难理解，从结果往回看比较好理解。
    结果的表头是 R 的表头的一部分，但不在 S 的表头中，结果与 S 做笛卡尔积又都在 R 中。
    除法经常用于求解“查询...全部的/所有的...”问题。